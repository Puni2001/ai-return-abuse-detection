<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return Abuse Detection Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .stat-card h3 {
            font-size: 0.85rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .stat-card.low { border-left: 4px solid #27ae60; }
        .stat-card.medium { border-left: 4px solid #f39c12; }
        .stat-card.high { border-left: 4px solid #e74c3c; }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .chart-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .chart-card h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        .orders-section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .orders-section h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #f8f9fa;
        }
        
        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 1rem;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .risk-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .risk-badge.low {
            background: #d4edda;
            color: #155724;
        }
        
        .risk-badge.medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .risk-badge.high {
            background: #f8d7da;
            color: #721c24;
        }
        
        .action-badge {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ°Ô∏è Return Abuse Detection Dashboard</h1>
        <p>Real-time monitoring and risk analysis for e-commerce returns</p>
    </div>
    
    <div class="container">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card low">
                <h3>Low Risk Orders</h3>
                <div class="value" id="lowRiskCount">0</div>
            </div>
            <div class="stat-card medium">
                <h3>Medium Risk Orders</h3>
                <div class="value" id="mediumRiskCount">0</div>
            </div>
            <div class="stat-card high">
                <h3>High Risk Orders</h3>
                <div class="value" id="highRiskCount">0</div>
            </div>
            <div class="stat-card">
                <h3>Avg Risk Score</h3>
                <div class="value" id="avgRiskScore">0.00</div>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <h2>Risk Distribution</h2>
                <canvas id="riskDistChart"></canvas>
            </div>
            <div class="chart-card">
                <h2>Risk Score Trend</h2>
                <canvas id="riskTrendChart"></canvas>
            </div>
        </div>
        
        <!-- Orders Table -->
        <div class="orders-section">
            <h2>Recent Orders</h2>
            <div class="filters">
                <button class="filter-btn active" onclick="filterOrders('all')">All Orders</button>
                <button class="filter-btn" onclick="filterOrders('high')">High Risk</button>
                <button class="filter-btn" onclick="filterOrders('medium')">Medium Risk</button>
                <button class="filter-btn" onclick="filterOrders('low')">Low Risk</button>
            </div>
            <table id="ordersTable">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Risk Score</th>
                        <th>Risk Level</th>
                        <th>Action</th>
                        <th>Top Risk Factors</th>
                    </tr>
                </thead>
                <tbody id="ordersTableBody">
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // Sample data - Replace with your API endpoint
        const API_ENDPOINT = 'https://nglukkm7m9.execute-api.ap-south-1.amazonaws.com/prod';
        
        // Generate sample orders for demo
        const sampleOrders = [
            {
                order_id: 'ORD001',
                customer_return_rate: 0.8,
                total_orders: 5,
                payment_method: 'COD',
                amount: 45000,
                product_return_rate: 0.4,
                is_festival_season: 0
            },
            {
                order_id: 'ORD002',
                customer_return_rate: 0.15,
                total_orders: 25,
                payment_method: 'Prepaid',
                amount: 2500,
                product_return_rate: 0.1,
                is_festival_season: 1
            },
            {
                order_id: 'ORD003',
                customer_return_rate: 0.45,
                total_orders: 8,
                payment_method: 'COD',
                amount: 15000,
                product_return_rate: 0.25,
                is_festival_season: 0
            },
            {
                order_id: 'ORD004',
                customer_return_rate: 0.05,
                total_orders: 50,
                payment_method: 'Prepaid',
                amount: 3500,
                product_return_rate: 0.08,
                is_festival_season: 1
            },
            {
                order_id: 'ORD005',
                customer_return_rate: 0.65,
                total_orders: 12,
                payment_method: 'COD',
                amount: 28000,
                product_return_rate: 0.35,
                is_festival_season: 0
            }
        ];
        
        let ordersData = [];
        let currentFilter = 'all';
        
        // Initialize dashboard
        async function initDashboard() {
            // Process sample orders
            for (const order of sampleOrders) {
                const result = await processOrder(order);
                ordersData.push(result);
            }
            
            updateStats();
            renderCharts();
            renderTable();
        }
        
        // Simulate API call or use actual endpoint
        async function processOrder(orderData) {
            // Mock response - replace with actual API call
            // const response = await fetch(API_ENDPOINT, {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify(orderData)
            // });
            // const result = await response.json();
            
            // Mock calculation for demo
            let risk_score = 0;
            if (orderData.customer_return_rate > 0.5) risk_score += 0.3;
            if (orderData.payment_method === 'COD') risk_score += 0.15;
            if (orderData.amount > 20000) risk_score += 0.2;
            if (orderData.product_return_rate > 0.3) risk_score += 0.1;
            
            const risk_level = risk_score < 0.3 ? 'low' : risk_score < 0.7 ? 'medium' : 'high';
            const action = risk_level === 'low' ? 'instant_refund' : 
                          risk_level === 'medium' ? 'otp_verification' : 'quality_check_required';
            
            const factors = [];
            if (orderData.customer_return_rate > 0.5) 
                factors.push(`High return rate: ${(orderData.customer_return_rate * 100).toFixed(0)}%`);
            if (orderData.payment_method === 'COD') 
                factors.push('COD payment method');
            if (orderData.amount > 20000) 
                factors.push(`High value: ‚Çπ${orderData.amount.toLocaleString()}`);
            
            return {
                order_id: orderData.order_id,
                risk_score: risk_score.toFixed(2),
                risk_level,
                recommended_action: action,
                explanation: { top_factors: factors }
            };
        }
        
        function updateStats() {
            const low = ordersData.filter(o => o.risk_level === 'low').length;
            const medium = ordersData.filter(o => o.risk_level === 'medium').length;
            const high = ordersData.filter(o => o.risk_level === 'high').length;
            const avg = (ordersData.reduce((sum, o) => sum + parseFloat(o.risk_score), 0) / ordersData.length).toFixed(2);
            
            document.getElementById('lowRiskCount').textContent = low;
            document.getElementById('mediumRiskCount').textContent = medium;
            document.getElementById('highRiskCount').textContent = high;
            document.getElementById('avgRiskScore').textContent = avg;
        }
        
        function renderCharts() {
            // Risk Distribution Chart
            const distCtx = document.getElementById('riskDistChart').getContext('2d');
            new Chart(distCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Low Risk', 'Medium Risk', 'High Risk'],
                    datasets: [{
                        data: [
                            ordersData.filter(o => o.risk_level === 'low').length,
                            ordersData.filter(o => o.risk_level === 'medium').length,
                            ordersData.filter(o => o.risk_level === 'high').length
                        ],
                        backgroundColor: ['#27ae60', '#f39c12', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            
            // Risk Trend Chart
            const trendCtx = document.getElementById('riskTrendChart').getContext('2d');
            new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ordersData.map(o => o.order_id),
                    datasets: [{
                        label: 'Risk Score',
                        data: ordersData.map(o => parseFloat(o.risk_score)),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }
        
        function renderTable() {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';
            
            const filtered = currentFilter === 'all' ? 
                ordersData : ordersData.filter(o => o.risk_level === currentFilter);
            
            filtered.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${order.order_id}</strong></td>
                    <td>${order.risk_score}</td>
                    <td><span class="risk-badge ${order.risk_level}">${order.risk_level}</span></td>
                    <td><span class="action-badge">${order.recommended_action.replace(/_/g, ' ')}</span></td>
                    <td>${order.explanation.top_factors.join(', ')}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function filterOrders(level) {
            currentFilter = level;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderTable();
        }
        
        // Initialize on load
        initDashboard();
    </script>
</body>
</html>
